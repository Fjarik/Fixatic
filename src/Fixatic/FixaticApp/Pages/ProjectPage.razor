@page "/project/{RouteProjectId:int}/{RouteSelectedTicketId:int?}"
@layout AppLayout
@using Fixatic.Types
@using Fixatic.Services
@using FixaticApp.Components

<style>
    .selected {
        background-color: #1E88E5 !important;
    }

        .selected > td {
            color: white !important;
        }

            .selected > td .mud-input {
                color: white !important;
            }
</style>

<MudGrid Style="height: 100vh">
    <MudItem xs="2" Class="pr-0">
        @if (Project != null)
        {
            <MudText Typo="Typo.h5" Class="pa-4 object-fill">@Project.Name</MudText>
            <MudDivider></MudDivider>

            <MudTable T="FullTicket" Style="height: 100vh"
                  Hover="true"
                  Items="@_tickets" @bind-SelectedItem="_selectedTicket">
                <HeaderContent>
                    <MudTh>Tickets</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Nr">@context.Title</MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager HorizontalAlignment="HorizontalAlignment.Left" HidePageNumber="true" HideRowsPerPage="true" />
                </PagerContent>
            </MudTable>
        }
        else
        {
            <MudText Typo="Typo.body1">Loading project tickets</MudText>
        }
    </MudItem>
    <MudItem xs="10" Class="pl-0">
        @if (_selectedTicket != null)
        {
            <MudToolBar Class="pl-0">
                <MudIconButton Icon="@Icons.Material.Outlined.Add" OnClick="OnAddTicket" />
                <MudIconButton Icon="@Icons.Material.Outlined.Comment" OnClick="OnCommentTicketAsync" />

                <MudIconButton Icon="@Icons.Material.Outlined.DeleteForever" OnClick="OnRemoveTicketAsync" />

                @if (_isFollowed)
                {
                    <MudIconButton Title="Followed" Icon="@Icons.Filled.Star" OnClick="OnFollowTicketClick" />
                }
                else
                {
                    <MudIconButton Title="Follow" Icon="@Icons.Filled.StarBorder" OnClick="OnFollowTicketClick" />
                }
            </MudToolBar>

            <MudDivider></MudDivider>

            <TicketView Model="_selectedTicket" />
        }
    </MudItem>
</MudGrid>