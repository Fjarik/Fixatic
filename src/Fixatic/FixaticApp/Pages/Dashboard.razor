@using Fixatic.Types

@page "/dashboard"
@layout AppLayout
<PageTitle>Dashboard</PageTitle>

<MudText Typo="Typo.h5" Class="pa-4">Dashboard</MudText>

@if (SelectedGroup != null)
{
    <MudToolBar>
        <MudIconButton Icon="@Icons.Material.Outlined.ArrowBack" OnClick="@ReturnButtonClicked"></MudIconButton>
        <MudSelect SelectedValuesChanged="@CategoryFilterClickedAsync" @bind-Value="@SelectedCategory" T="ProjectCategory"
                   Margin="Margin.Dense" Variant="Variant.Outlined" Style="max-width: 300px"
                   Placeholder="Category Filter">
            @foreach (var category in ProjectCategories)
            {
                <MudSelectItem T="ProjectCategory" Value="category"/>
            }
        </MudSelect>
    </MudToolBar>
}

<MudDivider></MudDivider>

<MudGrid>
    @if (Groups != null && SelectedGroup == null)
    {
        foreach (var group in Groups)
        {
            <MudItem xs="3">
                <MudCard>
                    <MudCardContent>
                        <MudText>@group.Name</MudText>
                        <MudText Typo="Typo.body2">@group.Description</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="@(() => GroupButtonClicked(group))">Projects</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    }
    
    @if (SelectedGroup != null && Projects != null)
    {
        foreach (var project in Projects)
        {
            <MudItem xs="3">
                <MudCard>
                    <MudCardContent>
                        <MudText>@project.Name</MudText>
                        <MudText Typo="Typo.body2">@project.Shortcut</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="@(() => ProjectButtonClicked(project))">Project</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    }
</MudGrid>

@if (SelectedGroup == null)
{
    <MudText Typo="Typo.h5" Class="pa-4">Followed Tickets</MudText>
    <MudDivider></MudDivider>

    <MudTable Items="@FollowedTickets" @ref="_ticketsTable" @bind-SelectedItem="_selectedTicket" RowClassFunc="@OnTicketClicked" T="Ticket">
        <HeaderContent>
            <MudTh>Tickets</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Nr">
                @context.Title
            </MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager HorizontalAlignment="HorizontalAlignment.Left" HidePageNumber="true" HideRowsPerPage="true"/>
        </PagerContent>
    </MudTable>
}

<style>
    .selected {
        background-color: #1E88E5 !important;
    }

        .selected > td {
            color: white !important;
        }

            .selected > td .mud-input {
                color: white !important;
            }
</style>